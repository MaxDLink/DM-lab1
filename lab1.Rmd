---
Title: Data Mining Lab 1
Authors: Max Link, Logan Lu, Jadon Klipsch
Date: "2025-02-21"
Description: "In this project, we will focus on cleaning and understanding the data.
  We will follow the Crisp-DM framework"
<!--output:
  pdf_document:
    latex_engine: xelatex-->
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


# Load required libraries!!
library(dplyr)      # For data manipulation
library(ggplot2)    # For visualizations
library(tidyr)      # For cleaning data
```

```{r dataframe}
# reading in Mobility Report
mobility_data <- read.csv('COVID-19/Global_Mobility_Report.csv')
texas_cases <- read.csv('COVID-19/COVID-19_cases_TX.csv') 
cases_plus <- read.csv('COVID-19/COVID-19_cases_plus_census.csv')

# displaying first 20 rows of report
# head(mobility_data, 20)

# texas cases 
# head(texas_cases, 20)
# + cases 
# head(cases_plus, 20)
```



# 1. Check for missing values in mobility_data

we can use colSums function to count the missing values in each column of the data

```{r}
missing_mobility <- colSums(is.na(mobility_data) | mobility_data == "")
print("Missing values in mobility_data:")
print(missing_mobility) 
```

We have quite a few missing values in the mobility data. We can get rid of them with filter.


# Mobility Data Cleaning and Visualizations 

```{r}

# Excluded holiday dates that would have misrepresented covid effects
excluded_dates <- as.Date(c("2020-12-25	", "2020-11-26", "2020-04-12", "2021-01-01"))  

# New clean mobility to exclude holiday dates
cmd <- mobility_data |>
  filter(!is.na(retail_and_recreation_percent_change_from_baseline)) |>
  filter(country_region == "United States") |> 
  filter(sub_region_2 != "") |> 
  filter(sub_region_1 != "") |> 
  select(-metro_area, -iso_3166_2_code, -census_fips_code, -country_region_code) |> 
  mutate(date = as.Date(date)) |> 
  filter(!date %in% excluded_dates)


```

Statistics for retail_and_recreation_percent_change_from_baseline

```{r}


# Function to calculate mode (since R doesn't have a built-in mode function)
get_mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}


```


```{r}
# Retail_and_recreation_percent_change_From_baseline mobility data 

retail_and_recreation <- cmd %>%
  summarise(
    Range = range(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE)[2] - range(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE)[1],
    Mean = mean(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE),
    Median = median(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE),
    Mode = get_mode(retail_and_recreation_percent_change_from_baseline),
    Variance = var(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE),
    Std_Dev = sd(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE)
  )
print("retail_and_recreation Statistics:")
print(retail_and_recreation)

```

Visually explore the chosen mobility data attributes appropriately. Provide an interpretation for each graph. Explain why you chose the visualization for each attribute type. [9 points]


```{r}

# Retail_and_recreation_percent_change_from_baseline
ggplot(cmd, aes(x = date, y = retail_and_recreation_percent_change_from_baseline)) +
  geom_line(color = "orange") +
  labs(title = "Retail and Recreation Mobility Change Over Time in The US",
       x = "Date", y = "Percent Change from Baseline") +
  theme_minimal()

```





```{r}


df_ordered <- cmd %>%
  group_by(sub_region_1) %>%
  mutate(median_value = median(retail_and_recreation_percent_change_from_baseline),
    min_value = min(retail_and_recreation_percent_change_from_baseline),  # Minimum value for each state
    max_value = max(retail_and_recreation_percent_change_from_baseline),
    count = n(),  # Number of data points# Maximum value for each state
  ) %>%
  ungroup() %>%
  arrange(median_value) |>
  mutate(state_with_count = paste(sub_region_1, "(n =", count, ")"))


min_labels <- df_ordered %>%
  filter(retail_and_recreation_percent_change_from_baseline == min_value) %>%
  group_by(sub_region_1) %>%
  slice(1) %>%  # Keep only the first occurrence of min
  ungroup()

max_labels <- df_ordered %>%
  filter(retail_and_recreation_percent_change_from_baseline == max_value) %>%
  group_by(sub_region_1) %>%
  slice(1) %>%  # Keep only the first occurrence of max
  ungroup()

# Plot with reordered states by median value
ggplot(df_ordered, aes(x = reorder(state_with_count, median_value), y = retail_and_recreation_percent_change_from_baseline)) +
      ylim(-120,300) +
  coord_flip() +
  geom_boxplot() +
  geom_text(data = min_labels, aes(label = date),
            hjust = 1.2, size = 2.5, color = "red") +
  # Label the maximum values
  geom_text(data = max_labels, aes(label = date),
            hjust = -0.2, size = 2.5, color = "darkgreen") +
  labs(title = "Retail Value Changes by State (Ordered by Median)", x = "State", y = "Value") +

    theme_minimal()


```
```{r}
# retail channge from baseline 
result <- cmd |>
  group_by(sub_region_1) |>

  summarize(min_value = min(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE),
    min_date = date[which.min(retail_and_recreation_percent_change_from_baseline)],
    max_value = max(retail_and_recreation_percent_change_from_baseline, na.rm = TRUE),
    max_date = date[which.max(retail_and_recreation_percent_change_from_baseline)])
print(result)
write.csv(result, "result.csv", row.names = FALSE)


```



```{r}

library(dplyr)
library(ggplot2)

# Minimum retail value dates by county
result_min <- cmd |>
  group_by(sub_region_2) |>  
  arrange(retail_and_recreation_percent_change_from_baseline, date) |>
  summarize(
    min_value = first(retail_and_recreation_percent_change_from_baseline),
    min_date = first(date)
  )


print(result_min)

# Count occurrences of min dates
date_counts_min <- table(result_min$min_date)
date_counts_df_min <- as.data.frame(date_counts_min)
sorted_dates_min <- date_counts_df_min[order(-date_counts_df_min$Freq), ]
print(sorted_dates_min)

# Histogram of minimum retail dates
ggplot(result_min, aes(x = min_date)) +
  geom_histogram(binwidth = 7, fill = "red", color = "black") +
  labs(
    title = "Histogram of Minimum Retail Value Change Dates",
    x = "Date of Minimum Retail Value",
    y = "Frequency"
  ) +
  theme_minimal()

# Maximum retail value dates by county
result_max <- cmd |>
  group_by(sub_region_2) |>
  arrange(desc(retail_and_recreation_percent_change_from_baseline), date) |>  # Sort by retail (descending) then date
  summarize(
    max_value = first(retail_and_recreation_percent_change_from_baseline),  # First retail value (maximum)
    max_date = first(date)      # Corresponding date
  )

print(result_max)

# Histogram of maximum retail dates
ggplot(result_max, aes(x = max_date)) +
  geom_histogram(binwidth = 7, fill = "green", color = "black") +
  labs(
    title = "Histogram of Maximum Retail Value Change Dates",
    x = "Date of Maximum Retail Value",
    y = "Frequency"
  ) +
  theme_minimal()

```
```{r}
# residential percent change from baseline 
# Excluded holiday dates that would have misrepresented COVID effects
excluded_dates <- as.Date(c("2020-12-25", "2020-11-26", "2020-04-12", "2021-01-01"))  

# Residential value change over time 
residential_df <- mobility_data |>
  filter(!is.na(residential_percent_change_from_baseline)) |>
  filter(country_region == "United States") |> 
  filter(sub_region_2 != "") |> 
  filter(sub_region_1 != "") |> 
  select(-metro_area, -iso_3166_2_code, -census_fips_code, -country_region_code) |> 
  mutate(date = as.Date(date)) |> 
  filter(!date %in% excluded_dates)
```

statistics for residential
```{r}
# Residential_Percent_Change_From_Baseline  mobility data 

Residential <- residential_df %>%
  summarise(
    Range = range(residential_percent_change_from_baseline, na.rm = TRUE)[2] - range(residential_percent_change_from_baseline, na.rm = TRUE)[1],
    Mean = mean(residential_percent_change_from_baseline, na.rm = TRUE),
    Median = median(residential_percent_change_from_baseline, na.rm = TRUE),
    Mode = get_mode(residential_percent_change_from_baseline),
    Variance = var(residential_percent_change_from_baseline, na.rm = TRUE),
    Std_Dev = sd(residential_percent_change_from_baseline, na.rm = TRUE)
  )
print("residential Statistics:")
print(Residential)


```

```{r}
# residential = at home 
# Residential_percent_change_from_baseline
ggplot(residential_df, aes(x = date, y = residential_percent_change_from_baseline)) +
  geom_line(color = "lightblue") +
  labs(title = "Residential Mobility Change Over Time in The US",
       x = "Date", y = "Percent Change from Baseline") +
  theme_minimal()


```


```{r}

df_ordered <- residential_df %>%
  group_by(sub_region_1) %>%
  mutate(
    median_value = median(residential_percent_change_from_baseline),
    min_value = min(residential_percent_change_from_baseline),  # Minimum value for each state
    max_value = max(residential_percent_change_from_baseline),
    count = n()  # Number of data points
  ) %>%
  ungroup() %>%
  arrange(median_value) |>
  mutate(state_with_count = paste(sub_region_1, "(n =", count, ")"))

min_labels <- df_ordered %>%
  filter(residential_percent_change_from_baseline == min_value) %>%
  group_by(sub_region_1) %>%
  slice(1) %>%  # Keep only the first occurrence of min
  ungroup()

max_labels <- df_ordered %>%
  filter(residential_percent_change_from_baseline == max_value) %>%
  group_by(sub_region_1) %>%
  slice(1) %>%  # Keep only the first occurrence of max
  ungroup()

# Plot with reordered states by median value
ggplot(df_ordered, aes(x = reorder(state_with_count, median_value), y = residential_percent_change_from_baseline)) +
  ylim(-120, 300) +
  coord_flip() +
  geom_boxplot() +
  geom_text(data = min_labels, aes(label = date),
            hjust = 1.2, size = 2.5, color = "red") +
  # Label the maximum values
  geom_text(data = max_labels, aes(label = date),
            hjust = -0.2, size = 2.5, color = "darkgreen") +
  labs(title = "Residential Value Changes by State (Ordered by Median)", x = "State", y = "Value") +
  theme_minimal()
```

```{r}
# table for min and max changes for residential baseline 

# Residential change from baseline 
result <- residential_df |>
  group_by(sub_region_1) |>
  summarize(
    min_value = min(residential_percent_change_from_baseline, na.rm = TRUE),
    min_date = date[which.min(residential_percent_change_from_baseline)],
    max_value = max(residential_percent_change_from_baseline, na.rm = TRUE),
    max_date = date[which.max(residential_percent_change_from_baseline)]
  )
print(result)
write.csv(result, "result.csv", row.names = FALSE)

```

```{r}
# histograms for min and max 
library(dplyr)
library(ggplot2)

# Minimum residential value dates by county
result_min <- residential_df |>
  group_by(sub_region_2) |>  
  arrange(residential_percent_change_from_baseline, date) |>
  summarize(
    min_value = first(residential_percent_change_from_baseline),
    min_date = first(date)
  )

print(result_min)

# Count occurrences of min dates
date_counts_min <- table(result_min$min_date)
date_counts_df_min <- as.data.frame(date_counts_min)
sorted_dates_min <- date_counts_df_min[order(-date_counts_df_min$Freq), ]
print(sorted_dates_min)

# Histogram of minimum residential dates
ggplot(result_min, aes(x = min_date)) +
  geom_histogram(binwidth = 7, fill = "red", color = "black") +
  labs(
    title = "Histogram of Minimum Residential Value Change Dates",
    x = "Date of Minimum Residential Value",
    y = "Frequency"
  ) +
  theme_minimal()

# Maximum residential value dates by county
result_max <- residential_df |>
  group_by(sub_region_2) |>
  arrange(desc(residential_percent_change_from_baseline), date) |>  # Sort by residential (descending) then date
  summarize(
    max_value = first(residential_percent_change_from_baseline),  # First residential value (maximum)
    max_date = first(date)      # Corresponding date
  )

print(result_max)

# Histogram of maximum residential dates
ggplot(result_max, aes(x = max_date)) +
  geom_histogram(binwidth = 7, fill = "green", color = "black") +
  labs(
    title = "Histogram of Maximum Residential Value Change Dates",
    x = "Date of Maximum Residential Value",
    y = "Frequency"
  ) +
  theme_minimal()

```
People started quarantining mid to late April. This matches the retail histograms above because people shopped early april and then quarantined mid to late april. 



# 2. Check for missing values in texas_cases

```{r}
missing_texas <- colSums(is.na(texas_cases))
print("Missing values in texas_cases:")
print(missing_texas)

head(texas_cases)

```

# Does clean_texas_cases.csv have any other values that need to be changed?

We want to convert the date field from <chr> to <date> so that we can do time series analysis, weekly totals, or rolling averages for the date. This would also allow us to merge into a new dataset later.

```{r}
head(texas_cases, 20)

# update the date column to Date format! 
texas_cases$date <- as.Date(texas_cases$date, format = "%Y-%m-%d")

# verify the updated data
print("Updated structure of texas_cases:")
str(texas_cases)
print("First 20 rows of updated texas_cases with Date format")
# head(texas_cases, 20)

# write to .csv 
write.csv(texas_cases, "clean_texas_cases.csv", row.names = FALSE)

```



Next, we can take county_name and state, and standardize them. We want to ensure they are consistent for merging with the county fields in the other .csv's later on.

```{r}
# county_name, state --> standardize & ensure consistency for merging with other .csvs
head(texas_cases, 5)

texas_cases$county_name <- tolower(texas_cases$county_name)
texas_cases$state <- tolower(texas_cases$state)

head(texas_cases, 5)

```

county_fips_code --\> standardize & ensure consistency for merging with other .csvs. Use county_fips code as primary key for geographic joins. county_fips compatible with U.S. country level data. Coordinate with state pip in clean_cases_plus_final.csv to match all texas with their texas pips

state_fips_Code --\> standardize & ensure consistency for merging with other .csvs

```{r}
# make county_fips_code five digits 
# make state_fips_code two digits 

texas_cases$county_fips_code <- sprintf("%05d", as.numeric(texas_cases$county_fips_code))
texas_cases$state_fips_code <- sprintf("%02d", as.numeric(texas_cases$state_fips_code))

head(texas_cases, 10)

write.csv(texas_cases, "clean_texas_cases.csv", row.names = FALSE)


```

Give appropriate statistics (range, mode, mean, median, variance, etc.) for the most important variables in Texas cases and describe what they mean or if you find something interesting. [9 points]


```{r}


# confirmed cases texas_cases 

confirmed_cases <- texas_cases %>%
  summarise(
    Range = range(confirmed_cases, na.rm = TRUE)[2] - range(confirmed_cases, na.rm = TRUE)[1],
    Mean = mean(confirmed_cases, na.rm = TRUE),
    Median = median(confirmed_cases, na.rm = TRUE),
    Mode = get_mode(confirmed_cases),
    Variance = var(confirmed_cases, na.rm = TRUE),
    Std_Dev = sd(confirmed_cases, na.rm = TRUE)
  )
print("confirmed_cases Statistics:")
print(confirmed_cases)



```

```{r}
# deaths texas_cases 

deaths <- texas_cases %>%
  summarise(
    Range = range(deaths, na.rm = TRUE)[2] - range(deaths, na.rm = TRUE)[1],
    Mean = mean(deaths, na.rm = TRUE),
    Median = median(deaths, na.rm = TRUE),
    Mode = get_mode(deaths),
    Variance = var(deaths, na.rm = TRUE),
    Std_Dev = sd(deaths, na.rm = TRUE)
  )
print("deaths Statistics:")
print(deaths)

```

Visually explore the chosen Texas Data attributes appropriately. Provide an interpretation for each graph. Explain why you chose the visualization for each attribute type. [9 points]

```{r}
# confirmed cases over time 
ggplot(texas_cases, aes(x = date, y = confirmed_cases)) +
  geom_line(color = "red") +
  labs(title = "Confirmed Cases Over Time in Texas",
       x = "Date", y = "Confirmed Cases") +
  theme_minimal()


```

```{r}
# Deaths (Texas_cases.csv)
ggplot(texas_cases, aes(x = date, y = deaths)) +
  geom_line(color = "darkorange") +
  labs(title = "Deaths Over Time in Texas",
       x = "Date", y = "Deaths") +
  theme_minimal()


```

Grab the standard deviation and averages of the confirmed cases and deaths. We want to filter out everything before march 1st because we only see results after 3/1. 

```{r}
std_and_avg <- texas_cases |>
  filter(date > "2020-03-01") |>
  group_by(county_name) |>
  summarize(
    avg_deaths = round(mean(deaths, na.rm = TRUE), 2),
    sd_deaths = round(sd(deaths, na.rm = TRUE), 2),
    avg_confirmed_cases = round(mean(confirmed_cases, na.rm = TRUE), 2),
    sd_confirmed_cases = round(sd(confirmed_cases, na.rm = TRUE), 2)
  )

print(std_and_avg)
write.csv(std_and_avg, "std_and_avg.csv", row.names = FALSE)


```
This data shows us how the daily count for cases and death changes for each county. 

```{r}

# growth rate for confirmed_cases and deaths 
texas_cases_with_growth_rate <- texas_cases |>
  filter(date > "2020-03-01") |> # skip march 1st 
  arrange(county_name, date) |> # sort by county name alphabetically, and date 
  mutate(cases_growth_rate = ifelse(lag(confirmed_cases) > 0, 
                              (confirmed_cases - lag(confirmed_cases)) / 
                                lag(confirmed_cases) * 100, 0)) |> 
  mutate(death_growth_rate = ifelse(lag(deaths) > 0, 
                              (deaths - lag(deaths)) / 
                                lag(deaths) * 100, 0))

# print(texas_cases_with_growth_rate)
write.csv(texas_cases_with_growth_rate, "texas_cases_with_growth_rate.csv", row.names = FALSE)

```

We added two new columns called cases_growth_rate and death_growth_rate. These columns show the growth rate of the cases and deaths, respectively. The deaths do not show as high a growth rate as the cases. We can make a chart to show this.  

```{r, fig.width=10}
# chart to show cases growth rate versus deaths growth rate per county 
library(dplyr)
library(ggplot2)
library(tidyr)

# Assuming the data is loaded as a data frame called 'texas_cases_with_growth_rate'
# If not, uncomment and adjust the following line to read your CSV:
# texas_cases_with_growth_rate <- read.csv("path_to_your_file.csv", stringsAsFactors = FALSE)

# Convert date to Date class if not already done
texas_cases_with_growth_rate <- texas_cases_with_growth_rate |>
  mutate(date = as.Date(date))

# Calculate statewide daily averages and filter out NAs
statewide_avg <- texas_cases_with_growth_rate |>
  group_by(date) |>
  summarize(
    avg_case_growth = mean(cases_growth_rate, na.rm = TRUE),
    avg_death_growth = mean(death_growth_rate, na.rm = TRUE)
  ) |>
  filter(!is.na(avg_case_growth) & !is.na(avg_death_growth))

# Pivot data to long format for easier plotting
statewide_long <- statewide_avg |>
  pivot_longer(
    cols = c(avg_case_growth, avg_death_growth),
    names_to = "metric",
    values_to = "growth_rate"
  ) |>
  mutate(metric = recode(metric, 
                         "avg_case_growth" = "Cases", 
                         "avg_death_growth" = "Deaths"))

# Create the plot
ggplot(statewide_long, aes(x = date, y = growth_rate, color = metric, fill = metric)) +
  geom_smooth(method = "loess", span = 0.1, size = 1.2, se = TRUE, alpha = 0.2) +
  scale_color_manual(values = c("Cases" = "#1f77b4", "Deaths" = "#d62728")) +
  scale_fill_manual(values = c("Cases" = "#1f77b4", "Deaths" = "#d62728")) +
  labs(
    title = "Daily Growth Rates of COVID-19 Cases and Deaths in Texas",
    subtitle = "Statewide Average with 95% Confidence Intervals (March 2020 - January 2021)",
    x = "Date",
    y = "Growth Rate (%)",
    color = "Metric",
    fill = "Metric"
  ) +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, 2)) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top",
    panel.grid.minor = element_blank()
  )



```

There are more cases than there are deaths.The growth rates for the cases vary by a significant amount, so we can capture finer changes by making another graph with a log scale. This log scale can show us smaller changes if we pick a small scale like 0.1% to 1000%
```{r, fig.width=10}

library(dplyr)
library(ggplot2)
library(tidyr)

# Convert date to Date class 
texas_cases_with_growth_rate <- texas_cases_with_growth_rate %>%
  mutate(date = as.Date(date))

# Calculate statewide daily averages and filter out NAs
statewide_avg <- texas_cases_with_growth_rate %>%
  group_by(date) %>%
  summarize(
    avg_case_growth = mean(cases_growth_rate, na.rm = TRUE),
    avg_death_growth = mean(death_growth_rate, na.rm = TRUE)
  ) %>%
  filter(!is.na(avg_case_growth) & !is.na(avg_death_growth))

# Pivot data to long format for plotting
statewide_long <- statewide_avg %>%
  pivot_longer( 
    cols = c(avg_case_growth, avg_death_growth),
    names_to = "metric",
    values_to = "growth_rate"
  ) %>%
  mutate(metric = recode(metric, # new metric column that holds growth_rates 
                         "avg_case_growth" = "Cases", 
                         "avg_death_growth" = "Deaths"))

# Define key Texas policy dates
policy_dates <- data.frame(
  date = as.Date(c("2020-03-31", "2020-05-01", "2020-07-02", "2020-11-30")),
  event = c("Statewide Lockdown", "Phase 1 Reopening", "Mask Mandate", "Thanksgiving Surge Warning")
)

# Create the enhanced plot with log-scale and event lines
ggplot(statewide_long, aes(x = date, y = growth_rate, color = metric, fill = metric)) +
  # Smoothed lines with confidence intervals
  geom_smooth(method = "loess", span = 0.1, size = 1.2, se = TRUE, alpha = 0.2) +
  # Add vertical event lines
  geom_vline(data = policy_dates, aes(xintercept = date), linetype = "dashed", color = "black", size = 0.5) +
  # Add labels for events (use only 'date' and 'event' from policy_dates, no 'metric')
  geom_text(data = policy_dates, aes(x = date, y = 1000, label = event), 
            angle = 90, vjust = -0.5, hjust = 1, size = 3.5, color = "black", 
            inherit.aes = FALSE) +  # Explicitly disable inheritance of aesthetics from ggplot()
  # Color scheme
  scale_color_manual(values = c("Cases" = "#1f77b4", "Deaths" = "#d62728")) +
  scale_fill_manual(values = c("Cases" = "#1f77b4", "Deaths" = "#d62728")) +
  # Log-scale y-axis to handle extreme spikes
  scale_y_log10(limits = c(0.1, 1000), breaks = c(0.1, 1, 10, 100, 1000), 
                labels = scales::comma, name = "Growth Rate (%)") +
  # X-axis with monthly breaks
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  # Labels and title
  labs(
    title = "Daily Growth Rates of COVID-19 Cases and Deaths in Texas",
    subtitle = "Statewide Average with 95% Confidence Intervals (Log Scale, March 2020 - January 2021)",
    x = "Date",
    y = "Growth Rate (%)",
    color = "Metric",
    fill = "Metric"
  ) +
  # Theme adjustments for clarity
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top",
    panel.grid.minor = element_blank()
  )


```
From this graph, we see that the lockdown mandate, mask mandate, and thanksgiving surge warning worked to flatten the curve. We see that small changes can have an impact.
```{r}
#max death and confirmed cases per county
max_deaths_per_county <- texas_cases |>
  group_by(county_name) |>
  summarize(max_deaths = max(deaths, na.rm = TRUE), Max_confirmed_cases = max(confirmed_cases, na.rm = TRUE)) |>
  arrange(desc(max_deaths))


print(max_deaths_per_county)

```

```{r}

options(repos = c(CRAN = "https://cloud.r-project.org/")) # for knitting to markdown 
install.packages("lubridate")  # If not installed
library(lubridate)
library(dplyr)
```


```{r}

# Calculate growth rates with additional bins
texas_cases_with_extended_Growth_Rate <- texas_cases %>%
  group_by(county_name) %>%
  mutate(
    # Find the date of the first non-zero case for each county
    date_of_first_case = date[which(confirmed_cases > 0)[1]],
    
    # Calculate rate of growth for the first 30 days after the first case
    rate_of_growth_first_30_days = ifelse(
      date > date_of_first_case & date < date_of_first_case + days(30),
      (confirmed_cases - lag(confirmed_cases, 1)) / lag(confirmed_cases, 1) * 100,
      NA
    ),
    
    # Calculate rate of growth for days 31 to 60 after the first case
    rate_of_growth_30_60_days = ifelse(
      date >= date_of_first_case + days(30) & date < date_of_first_case + days(60),
      (confirmed_cases - lag(confirmed_cases, 1)) / lag(confirmed_cases, 1) * 100,
      NA
    ),
    
    # Calculate rate of growth for days 61 to 90 after the first case
    rate_of_growth_60_90_days = ifelse(
      date >= date_of_first_case + days(60) & date < date_of_first_case + days(90),
      (confirmed_cases - lag(confirmed_cases, 1)) / lag(confirmed_cases, 1) * 100,
      NA
    ),
    
    # Calculate rate of growth for days 91 to 120 after the first case
    rate_of_growth_90_120_days = ifelse(
      date >= date_of_first_case + days(90) & date < date_of_first_case + days(120),
      (confirmed_cases - lag(confirmed_cases, 1)) / lag(confirmed_cases, 1) * 100,
      NA
    ),
    
    # Calculate rate of growth for days 121 to 150 after the first case
    rate_of_growth_120_150_days = ifelse(
      date >= date_of_first_case + days(120) & date < date_of_first_case + days(150),
      (confirmed_cases - lag(confirmed_cases, 1)) / lag(confirmed_cases, 1) * 100,
      NA
    ),
    
    # Calculate rate of growth for days 151 to 180 after the first case
    rate_of_growth_150_180_days = ifelse(
      date >= date_of_first_case + days(150) & date < date_of_first_case + days(180),
      (confirmed_cases - lag(confirmed_cases, 1)) / lag(confirmed_cases, 1) * 100,
      NA
    )
  ) %>%
  group_by(county_name) %>%
  summarise(
    # Calculate average rates of growth over the specified periods
    date_of_first_case = first(na.omit(date_of_first_case)),
    rate_of_growth_first_30_days = mean(na.omit(rate_of_growth_first_30_days)),
    rate_of_growth_30_60_days = mean(na.omit(rate_of_growth_30_60_days)),
    rate_of_growth_60_90_days = mean(na.omit(rate_of_growth_60_90_days)),
    rate_of_growth_90_120_days = mean(na.omit(rate_of_growth_90_120_days)),
    rate_of_growth_120_150_days = mean(na.omit(rate_of_growth_120_150_days)),
    rate_of_growth_150_180_days = mean(na.omit(rate_of_growth_150_180_days))
  ) %>%
  ungroup()

# Show a summary of the new data frame
summary(texas_cases_with_extended_Growth_Rate)




```

# 3. Check for missing values in cases_plus

```{r}
missing_cases_plus <- colSums(is.na(cases_plus))
# print("Missing values in cases_plus:")
# print(missing_cases_plus)
```

We have 3142 missing values in certain columns. This means that these columns are completely empty because there are 3142 rows in the data. We can completely remove these columns and then prune for columns that only have some missing values like median_rent.

```{r}

# Get the total number of rows in cases_plus
total_rows <- nrow(cases_plus)

# Count missing values in each column
missing_counts <- colSums(is.na(cases_plus))

# Debug: Print the missing counts to check values
# print("Missing value counts in cases_plus:")
# print(missing_counts)

# Identify columns with missing values equal to the total number of rows (completely empty)
empty_columns <- names(missing_counts[missing_counts == total_rows])

# Debug: Print the empty columns to verify
# print("Columns identified as completely empty:")
# print(empty_columns)
# Remove completely empty columns from cases_plus
cases_plus_cleaned <- cases_plus[, !names(cases_plus) %in% empty_columns]

# Verify the number of columns before and after removal
# print(paste("Original number of columns in cases_plus:", ncol(cases_plus)))
# print(paste("Number of columns after removing empty columns:", ncol(cases_plus_cleaned)))

```

Finish cleaning by removing any missing values in other columns like median_rent

```{r}
# --------- 
# now remove rows with any remaining missing values (e.g., in median_rent, which has 2 NAs)
clean_cases_plus_final <- na.omit(cases_plus_cleaned)

# verify the number of rows before and after each step
print(paste("Original number of rows in cases_plus:", nrow(cases_plus)))
print("empty columns: ", length(empty_columns))
print(paste("Number of rows after removing empty columns:", nrow(cases_plus_cleaned)))
print(paste("Number of rows after removing rows with any remaining missing values:", nrow(clean_cases_plus_final)))

# check for missing values in the final cleaned dataset to confirm
missing_final <- colSums(is.na(clean_cases_plus_final))
print("Missing values in clean_cases_plus_final:")
# print(missing_final)

# display the first few rows of the final cleaned dataset
# head(clean_cases_plus_final)

write.csv(clean_cases_plus_final, "clean_cases_plus_final.csv", row.names = FALSE)

```

# Does cases_plus have any other values that need to be changed?

We can convert the date from <chr> to <date> format for time series analysis.

```{r}
# head(clean_cases_plus_final, 10)


# update the date column to Date format 
clean_cases_plus_final$date <- as.Date(clean_cases_plus_final$date, format = "%Y-%m-%d")

# verify the updated data
print("Updated structure of clean_cases_plus_final:")
# str(clean_cases_plus_final)
print("First 5 rows of updated texas_cases with Date format")
# head(clean_cases_plus_final, 5)
write.csv(clean_cases_plus_final, "clean_cases_plus_final.csv", row.names = FALSE)


```

Looking at the geographic identifiers:

The state_fips_code and county_fips_code may be standardized. The state_fips_code must have always have two digits and the county_fips_code must always have five digits. We can fix this with zeros.

```{r}
# number stored as text error on line 9 adding a zero in front & it is moving numbers over 
clean_cases_plus_final$county_fips_code <- sprintf("%05d", as.numeric(clean_cases_plus_final$county_fips_code))
clean_cases_plus_final$state_fips_code <- sprintf("%02d", as.numeric(clean_cases_plus_final$state_fips_code))

# head(clean_cases_plus_final, 20)

write.csv(clean_cases_plus_final, "clean_cases_plus_final.csv", row.names = FALSE)
```

We can make the county_name and state columns lowercase

```{r}
# Convert county_name and state to lowercase
clean_cases_plus_final$county_name <- tolower(clean_cases_plus_final$county_name)
clean_cases_plus_final$state <- tolower(clean_cases_plus_final$state)

# Verify the changes (first 5 rows)
# head(clean_cases_plus_final, 5)


# Write the updated clean_cases_plus_final to a CSV file
write.csv(clean_cases_plus_final, "clean_cases_plus_final.csv", row.names = FALSE)

```


Give appropriate statistics (range, mode, mean, median, variance, etc.) for the most important variables in cases plus and describe what they mean or if you find something interesting. [9 points]

```{r}

# median_income: 

income_stats <- clean_cases_plus_final %>%
  summarise(
    Range = range(median_income, na.rm = TRUE)[2] - range(median_income, na.rm = TRUE)[1],
    Mean = mean(median_income, na.rm = TRUE),
    Median = median(median_income, na.rm = TRUE),
    Mode = get_mode(median_income),
    Variance = var(median_income, na.rm = TRUE),
    Std_Dev = sd(median_income, na.rm = TRUE)
  )
print("Median_Income Statistics:")
print(income_stats)


```

```{r}

# confirmed cases: 


confirmed_cases_stats <- clean_cases_plus_final %>%
  summarise(
    Range = range(confirmed_cases, na.rm = TRUE)[2] - range(confirmed_cases, na.rm = TRUE)[1],
    Mean = mean(confirmed_cases, na.rm = TRUE),
    Median = median(confirmed_cases, na.rm = TRUE),
    Mode = get_mode(confirmed_cases),
    Variance = var(confirmed_cases, na.rm = TRUE),
    Std_Dev = sd(confirmed_cases, na.rm = TRUE)
  )
print("confirmed_cases Statistics:")
print(confirmed_cases_stats)



 
```

```{r}
# Death: 

death_stats <- clean_cases_plus_final %>%
  summarise(
    Range = range(deaths, na.rm = TRUE)[2] - range(deaths, na.rm = TRUE)[1],
    Mean = mean(deaths, na.rm = TRUE),
    Median = median(deaths, na.rm = TRUE),
    Mode = get_mode(deaths),
    Variance = var(deaths, na.rm = TRUE),
    Std_Dev = sd(deaths, na.rm = TRUE)
  )
print("death Statistics:")
print(death_stats)




```

```{r}
# median_age: 

median_age_stats <- clean_cases_plus_final %>%
  summarise(
    Range = range(median_age, na.rm = TRUE)[2] - range(median_age, na.rm = TRUE)[1],
    Mean = mean(median_age, na.rm = TRUE),
    Median = median(median_age, na.rm = TRUE),
    Mode = get_mode(median_age),
    Variance = var(median_age, na.rm = TRUE),
    Std_Dev = sd(median_age, na.rm = TRUE)
  )
print("median_age Statistics:")
print(median_age_stats)



```


Visually explore the chosen attributes in Cases Plus appropriately. Provide an interpretation for each graph. Explain why you chose the visualization for each attribute type. [9 points]

```{r}
# median income graph 

ggplot(clean_cases_plus_final, aes(x = median_income)) +
  geom_histogram(binwidth = 5000, fill = "blue", color = "black") +
  labs(title = "Distribution of Median Income in US Counties",
       x = "Median Income ($)", y = "Frequency") +
  theme_minimal()

```



```{r}
# deaths
ggplot(clean_cases_plus_final, aes(y = deaths)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Box Plot of Deaths in US Counties",
       y = "Deaths") +
  theme_minimal()

```

```{r}
# Median_age
ggplot(clean_cases_plus_final, aes(x = median_age)) +
  geom_histogram(binwidth = 1, fill = "purple", color = "black") +
  labs(title = "Distribution of Median Age in US Counties",
       x = "Median Age (years)", y = "Frequency") +
  theme_minimal()


```


Outlier detection identifies extreme values in cases and deaths that could skew the analysis. Large counties could have extremely high death rates, which would change averages. Outlier could be real cases, or they could be errors in data. We must judge whether to keep them or not.
```{r}
# outlier detection 


# make a boxplot for each clean dataframe


# clean_cases_plus_final 

# Filter the dataframe to include only Texas (TX)
tx_outliers_clean_cases_plus = clean_cases_plus_final[clean_cases_plus_final$state == "tx", ]

# Create the boxplot for Texas only
crop = ggplot(data = tx_outliers_clean_cases_plus, 
              mapping = aes(x = state, y = confirmed_cases)) + 
       geom_boxplot() +
       labs(title = "Boxplot of Confirmed Cases in Texas",
            x = "State",
            y = "Confirmed Cases") +
       theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels


# Display the plot
crop

```



3.  Data Preparation [30]

Create a data set with objects as rows and features as columns. Use as objects counties in the US. The data set must be included in your report. Provide a table in your Word document that shows the data (values) for the first 10 rows for all the features you have selected and/or created. Interesting additional features may be, for example: [30 points]

How (densely) populated is the county? TOTOAL POP. What resources does a county have (money, hospital)? MEDIAN_INCOME What is the social distancing response, and how long did it take after the first case? You can come up with more critical questions for your chosen stakeholder.

Explore relationships between attributes: Look at the attributes and then use cross-tabulation, correlation, group-wise averages, box plots, etc., as appropriate. [9 points]




```{R}

# Load dplyr if not already loaded (you likely have this already)
library(dplyr)

# Filter for only TX
tx_data <- clean_cases_plus_final[clean_cases_plus_final$state == "tx", ]

# Select specific columns for analysis
tx_data <- subset(tx_data, select = c(county_name, confirmed_cases, deaths, median_age, median_income, total_pop))

# Alphabetize by county_name
tx_data <- tx_data %>%
  arrange(county_name)

# Show the first 10 rows
head(tx_data, 10)


```


```{r}
# Load required package
library(dplyr)

# Join tx_data with the growth rate columns from texas_cases_with_extended_Growth_Rate
tx_data_with_gr <- tx_data %>%
  left_join(texas_cases_with_extended_Growth_Rate, by = "county_name") %>%
  mutate(
    infection_rate = confirmed_cases / total_pop,
    death_rate = deaths / confirmed_cases
  )

# Show the updated table
# tx_data_with_gr

# Write the updated table to CSV
write.csv(tx_data_with_gr, "tx_data_with_gr.csv", row.names = FALSE)

```


now we can visualize our new object. We can visualize the growth rates in the top 10 texas counties. We can compare day 0 to day 150 to see trends.

Started with day 0 to day 60
```{r, fig.width=10}
library(dplyr)
library(ggplot2)
library(tidyr)

# Select the top 10 counties by rate_of_growth_first_30_days
top_counties <- tx_data_with_gr %>%
  arrange(desc(rate_of_growth_first_30_days)) %>%
  slice_head(n = 10)

# Pivot the growth rates to long format for plotting
top_counties_long <- top_counties %>%
  select(county_name, rate_of_growth_first_30_days, rate_of_growth_30_60_days) %>%
  pivot_longer(
    cols = c(rate_of_growth_first_30_days, rate_of_growth_30_60_days),
    names_to = "period",
    values_to = "growth_rate"
  ) %>%
  mutate(period = recode(period,
                         "rate_of_growth_first_30_days" = "First 30 Days",
                         "rate_of_growth_30_60_days" = "Days 31-60"))

# Create the paired bar chart
ggplot(top_counties_long, aes(x = growth_rate, y = county_name, fill = period)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("First 30 Days" = "#1f77b4", "Days 31-60" = "#d62728")) +
  labs(
    title = "COVID-19 Case Growth Rates in Top 10 Texas Counties",
    subtitle = "Comparing First 30 Days vs. Days 31-60 After First Case",
    x = "Average Daily Growth Rate (%)",
    y = "County",
    fill = "Period"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "top"
  )


```
Tried 0 to 180
```{r, fig.width=10}

library(dplyr)
library(ggplot2)
library(tidyr)

# Select the top 10 counties by rate_of_growth_first_30_days
top_counties <- texas_cases_with_extended_Growth_Rate %>%
  arrange(desc(rate_of_growth_first_30_days)) %>%
  slice_head(n = 10)

# Pivot the growth rates to long format for plotting, including all six periods
top_counties_long <- top_counties %>%
  select(county_name, rate_of_growth_first_30_days, rate_of_growth_30_60_days, 
         rate_of_growth_60_90_days, rate_of_growth_90_120_days, 
         rate_of_growth_120_150_days, rate_of_growth_150_180_days) %>%
  pivot_longer(
    cols = c(rate_of_growth_first_30_days, rate_of_growth_30_60_days, 
             rate_of_growth_60_90_days, rate_of_growth_90_120_days, 
             rate_of_growth_120_150_days, rate_of_growth_150_180_days),
    names_to = "period",
    values_to = "growth_rate"
  ) %>%
  mutate(period = recode(period,
                         "rate_of_growth_first_30_days" = "Days 1-30",
                         "rate_of_growth_30_60_days" = "Days 31-60",
                         "rate_of_growth_60_90_days" = "Days 61-90",
                         "rate_of_growth_90_120_days" = "Days 91-120",
                         "rate_of_growth_120_150_days" = "Days 121-150",
                         "rate_of_growth_150_180_days" = "Days 151-180"))

# Create the paired bar chart
ggplot(top_counties_long, aes(x = growth_rate, y = county_name, fill = period)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("Days 1-30" = "#1f77b4", "Days 31-60" = "#d62728",
                              "Days 61-90" = "#2ca02c", "Days 91-120" = "#ff7f0e",
                              "Days 121-150" = "#9467bd", "Days 151-180" = "#8c564b")) +
  labs(
    title = "COVID-19 Case Growth Rates in Top 10 Texas Counties",
    subtitle = "Comparing Growth Rates Across Six 30-Day Periods After First Case",
    x = "Average Daily Growth Rate (%)",
    y = "County",
    fill = "Period"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "top"
  )

```
Tried days 30-180 to zoom in visually
```{r, fig.width=10}
# graph without the first 30 days 
library(dplyr)
library(ggplot2)
library(tidyr)

# Select the top 10 counties by rate_of_growth_30_60_days (first remaining period)
top_counties <- texas_cases_with_extended_Growth_Rate %>%
  arrange(desc(rate_of_growth_30_60_days)) %>%
  slice_head(n = 10)

# Pivot the growth rates to long format for plotting, excluding first 30 days
top_counties_long <- top_counties %>%
  select(county_name, rate_of_growth_30_60_days, rate_of_growth_60_90_days, 
         rate_of_growth_90_120_days, rate_of_growth_120_150_days, 
         rate_of_growth_150_180_days) %>%
  pivot_longer(
    cols = c(rate_of_growth_30_60_days, rate_of_growth_60_90_days, 
             rate_of_growth_90_120_days, rate_of_growth_120_150_days, 
             rate_of_growth_150_180_days),
    names_to = "period",
    values_to = "growth_rate"
  ) %>%
  mutate(period = recode(period,
                         "rate_of_growth_30_60_days" = "Days 31-60",
                         "rate_of_growth_60_90_days" = "Days 61-90",
                         "rate_of_growth_90_120_days" = "Days 91-120",
                         "rate_of_growth_120_150_days" = "Days 121-150",
                         "rate_of_growth_150_180_days" = "Days 151-180"))

# Create the paired bar chart
ggplot(top_counties_long, aes(x = growth_rate, y = county_name, fill = period)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("Days 31-60" = "#d62728",
                              "Days 61-90" = "#2ca02c",
                              "Days 91-120" = "#ff7f0e",
                              "Days 121-150" = "#9467bd",
                              "Days 151-180" = "#8c564b")) +
  labs(
    title = "COVID-19 Case Growth Rates in Top 10 Texas Counties",
    subtitle = "Comparing Growth Rates Across Days 31-180 After First Case",
    x = "Average Daily Growth Rate (%)",
    y = "County",
    fill = "Period"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "top"
  )

```


```{r}
# install tigris for graphs 
install.packages("tigris")
install.packages("reshape2")
install.packages("sf")
library(sf)

```


Making more graphs for comparison of variables from our new object
```{r}
# infection rate 
library(ggplot2)

# Create the scatter plot
ggplot(tx_data_with_gr, aes(x = median_age, y = infection_rate, color = median_income, size = total_pop)) +
  geom_point(alpha = 0.6) +
  scale_color_gradient(low = "#d62728", high = "#1f77b4", name = "Median Income ($)") +
  scale_y_continuous(labels = scales::percent) +
  scale_size_continuous(name = "Population") +
  labs(
    title = "Infection Rate vs. Median Age in Texas Counties",
    subtitle = "Colored by Median Income, Sized by Population",
    x = "Median Age",
    y = "Infection Rate (% of Population)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )

# ------- 
library(dplyr)
library(ggplot2)

# Select the top 10 counties by infection_rate
top_10_counties <- tx_data_with_gr %>%
  arrange(desc(infection_rate)) %>%
  slice_head(n = 10)

# Create the horizontal bar chart
ggplot(top_10_counties, aes(x = infection_rate, y = county_name, fill = county_name)) +
  geom_bar(stat = "identity") +
  scale_x_continuous(labels = scales::percent) +
  labs(
    title = "Top 10 Texas Counties by Infection Rate",
    x = "Infection Rate (% of Population)",
    y = "County",
    fill = "County"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.y = element_text(size = 10),
    legend.position = "none"  # Remove legend since fill is redundant with y-axis
  )

library(ggplot2)

# Create the histogram
ggplot(tx_data_with_gr, aes(x = infection_rate)) +
  geom_histogram(binwidth = 0.01, fill = "#1f77b4", color = "black", alpha = 0.7) +
  scale_x_continuous(labels = scales::percent) +
  labs(
    title = "Distribution of Infection Rate Across Texas Counties",
    x = "Infection Rate (% of Population)",
    y = "Number of Counties"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")
  )

library(tigris)
library(sf)
library(dplyr)
library(ggplot2)

# Load Texas county shapefile
tx_counties <- counties(state = "TX", cb = TRUE, class = "sf")

# Clean county names in tx_data_with_gr to match shapefile (remove " county" and capitalize)
tx_data_with_gr <- tx_data_with_gr %>%
  mutate(county_name_clean = toupper(gsub(" county", "", county_name)))

# Clean county names in shapefile (remove " County" and capitalize)
tx_counties <- tx_counties %>%
  mutate(NAME = toupper(gsub(" County", "", NAME)))

# Join the data with the shapefile
tx_map_data <- tx_counties %>%
  left_join(tx_data_with_gr, by = c("NAME" = "county_name_clean"))

# Create the choropleth map
ggplot(data = tx_map_data) +
  geom_sf(aes(fill = infection_rate)) +
  scale_fill_gradient(low = "#fee8c8", high = "#e34a33", 
                      labels = scales::percent, name = "Infection Rate") +
  labs(
    title = "Infection Rate by County in Texas",
    subtitle = "Proportion of Population Infected"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )

library(dplyr)
library(ggplot2)

# Select the top 10 counties by infection_rate
top_10_counties <- tx_data_with_gr %>%
  arrange(desc(infection_rate)) %>%
  slice_head(n = 10)

# Create the horizontal bar chart
ggplot(top_10_counties, aes(x = infection_rate, y = reorder(county_name, infection_rate), fill = county_name)) +
  geom_bar(stat = "identity") +
  scale_x_continuous(labels = scales::percent) +
  labs(
    title = "Top 10 Texas Counties by Infection Rate",
    x = "Infection Rate (% of Population)",
    y = "County",
    fill = "County"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "none"
  )

library(ggplot2)

# Create the scatter plot
ggplot(tx_data_with_gr, aes(x = median_age, y = infection_rate)) +
  geom_point(color = "#1f77b4", alpha = 0.6) +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Infection Rate vs. Median Age in Texas Counties",
    x = "Median Age",
    y = "Infection Rate (% of Population)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")
  )

library(ggplot2)

# Create the scatter plot with color
ggplot(tx_data_with_gr, aes(x = median_age, y = infection_rate, color = median_income)) +
  geom_point(alpha = 0.6) +
  scale_color_gradient(low = "#d62728", high = "#1f77b4", name = "Median Income ($)") +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Infection Rate vs. Median Age in Texas Counties",
    subtitle = "Colored by Median Income",
    x = "Median Age",
    y = "Infection Rate (% of Population)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )

library(ggplot2)

# Create the scatter plot with size
ggplot(tx_data_with_gr, aes(x = median_age, y = infection_rate, size = total_pop)) +
  geom_point(color = "#1f77b4", alpha = 0.6) +
  scale_y_continuous(labels = scales::percent) +
  scale_size_continuous(name = "Population") +
  labs(
    title = "Infection Rate vs. Median Age in Texas Counties",
    subtitle = "Sized by Total Population",
    x = "Median Age",
    y = "Infection Rate (% of Population)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )

library(dplyr)
library(ggplot2)
library(reshape2)

# Calculate the average growth rate across all periods
tx_data_with_gr <- tx_data_with_gr %>%
  mutate(avg_growth_rate = rowMeans(select(., starts_with("rate_of_growth")), na.rm = TRUE))

# Select variables for correlation
corr_data <- tx_data_with_gr %>%
  select(infection_rate, median_age, median_income, total_pop, death_rate, avg_growth_rate)

# Calculate correlation matrix
corr_matrix <- cor(corr_data, use = "complete.obs")

# Melt the matrix for ggplot
corr_melted <- melt(corr_matrix)

# Create the heatmap
ggplot(corr_melted, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "#d62728", mid = "white", high = "#1f77b4", 
                       name = "Correlation", limits = c(-1, 1)) +
  geom_text(aes(label = round(value, 2)), color = "black", size = 4) +
  labs(
    title = "Correlation Heatmap of Infection Rate and Other Variables",
    x = "",
    y = ""
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

library(ggplot2)

# Create the scatter plot
ggplot(tx_data_with_gr, aes(x = median_age, y = infection_rate, color = median_income, size = total_pop)) +
  geom_point(alpha = 0.6) +
  scale_color_gradient(low = "#d62728", high = "#1f77b4", name = "Median Income ($)") +
  scale_y_continuous(labels = scales::percent) +
  scale_size_continuous(name = "Population") +
  labs(
    title = "Infection Rate vs. Median Age in Texas Counties",
    subtitle = "Colored by Median Income, Sized by Population",
    x = "Median Age",
    y = "Infection Rate (% of Population)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )


library(dplyr)
library(ggplot2)

# Create age groups based on median_age
tx_data_with_gr <- tx_data_with_gr %>%
  mutate(age_group = cut(median_age, 
                         breaks = c(0, 30, 35, 40, 45, 50, Inf),
                         labels = c("<30", "30-35", "35-40", "40-45", "45-50", "50+")))

# Create the box plot
ggplot(tx_data_with_gr, aes(x = age_group, y = infection_rate, fill = age_group)) +
  geom_boxplot() +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Infection Rate by Median Age Group in Texas Counties",
    x = "Median Age Group",
    y = "Infection Rate (% of Population)",
    fill = "Age Group"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "none"
  )


  library(ggplot2)

# Scatter plot with trend line
ggplot(tx_data_with_gr, aes(x = avg_growth_rate, y = infection_rate)) +
  geom_point(color = "#1f77b4", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::percent) +
  labs(
    title = "Infection Rate vs. Average Growth Rate in Texas Counties",
    x = "Average Growth Rate (% per Day)",
    y = "Infection Rate (% of Population)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")
  )

  library(ggplot2)

# Scatter plot with color by median_age
ggplot(tx_data_with_gr, aes(x = infection_rate, y = death_rate, color = median_age)) +
  geom_point(alpha = 0.6) +
  scale_x_continuous(labels = scales::percent) +
  scale_y_continuous(labels = scales::percent) +
  scale_color_gradient(low = "#d62728", high = "#1f77b4", name = "Median Age") +
  labs(
    title = "Infection Rate vs. Death Rate in Texas Counties",
    subtitle = "Colored by Median Age",
    x = "Infection Rate (% of Population)",
    y = "Death Rate (% of Cases)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "right"
  )

  library(dplyr)
library(ggplot2)

# Use the age_group column created earlier
# Create the box plot
ggplot(tx_data_with_gr, aes(x = age_group, y = death_rate, fill = age_group)) +
  geom_boxplot() +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Death Rate by Median Age Group in Texas Counties",
    x = "Median Age Group",
    y = "Death Rate (% of Cases)",
    fill = "Age Group"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "none"
  )

  library(ggplot2)

# Scatter plot with trend line
ggplot(tx_data_with_gr, aes(x = total_pop, y = avg_growth_rate)) +
  geom_point(color = "#1f77b4", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  scale_y_continuous(labels = scales::percent) +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Average Growth Rate vs. Total Population in Tx Counties",
    x = "Total Population",
    y = "Average Growth Rate (% per Day)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")
  )




```

